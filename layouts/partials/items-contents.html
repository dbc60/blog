{{ "<!-- BEGIN layouts/partials/items-contents.html -->" | safeHTML }}
            <ul class="collection-items">
              <!--
                sort by date (in reverse chronological order) or by weight
                depending on the section name.
              -->
            {{ $byDate := false -}}
            {{- $byWeight := false -}}
            {{ $name := "" }}

            <!-- journal entries are sorted by date-->
            {{- if eq .context.Section "journal" }}
              {{ "<!-- section: journal by date -->" | safeHTML }}
              {{ $byDate = true -}}
            {{- end -}}
            <!--
              sections under "contacts" have an _index.md with their weight in
              the front matter
            -->
            {{- if eq .context.Section "contact" }}
            {{ "<!-- section: contact by weight -->" | safeHTML }}
            {{ $byWeight = true -}}
            {{- end -}}

            <!--
              Yearly sections are listed by month. This will work for years
              2000-2099, which is good enough for me. Remember that Hugo uses
              Go's regular expression package, so a return value of nil means
              there were no matches.
            -->
            {{- if ne nil (findRE "20[0-9][0-9]" .context.Section) -}}
              {{- $section := .context.Section -}}
              {{- $name := .context.Name }}
              {{- $count1 := 0 -}}
              {{- $months := slice -}}
              {{- $parent := .context.Parent -}}
              {{- range .context.Site.RegularPages -}}
                {{- if isset .Params $section -}}
                  {{- range $k, $v := .Params }}
                    {{- if eq $k $section -}}
                      <!-- $v is the month -->
                      {{- $months = $months | append $v -}}
                    {{- end -}}
                  {{- end -}}
                  {{- $count1 = add $count1 1 -}}
                {{- end -}}
              {{- end -}}
              {{- $months = uniq $months | sort -}}
              {{- range $m := $months -}}
              <li class="collection-item">
                <a class="secondary-nav__link" href="{{ $.context.Site.BaseURL }}/{{ $section }}/{{ $m }}/">
                  {{- $section }}/{{ . -}}
                </a>
              </li>
              {{- end -}}

            {{- else -}}

              <!-- sort out the section name -->
              {{- $sections := .context.Sections -}}
              {{- if eq $sections nil }}
                {{- $sections = .context.Parent.Sections -}}
                {{- $name = .context.Parent.Name -}}
                {{- if eq $sections nil }}
                  {{- $sections = .context.Parent.Parent.Sections -}}
                  {{- $name = .context.Parent.Parent.Name -}}
                {{- end -}}
              {{- else -}}
                {{- $name = .context.Name -}}
              {{- end -}}

              <!-- list Weekly things in reverse chronological order -->
              {{- if in $name "Week" -}}
                {{- $byDate = true -}}
              {{- end -}}

              {{- if $byDate -}}
                {{ "<!-- range by date -->" | safeHTML }}
                {{- range $sections.ByDate.Reverse }}
                <li class="collection-item">
                  <a class="secondary-nav__link" href="{{ .Permalink }}">
                    {{- .Title -}}
                  </a>
                </li>
                {{ end -}}
              {{- else if $byWeight -}}
                {{- $listLimit := 100 -}}
                {{- if isset .context.Site.Params "list_limit" -}}
                  {{- $listLimit = .context.Site.Params.list_limit -}}
                {{- end -}}
                {{ "<!-- range by weight -->" | safeHTML }}
                {{- range first $listLimit  $sections.ByWeight }}
                <li class="collection-item">
                  <a class="secondary-nav__link" href="{{ .Permalink }}">
                    {{- .Title -}}
                  </a>
                </li>
                {{ end -}}
              {{- else -}} <!-- not by date or weight -->
                {{- $listLimit := 100 -}}
                {{- if isset .context.Site.Params "list_limit" -}}
                  {{- $listLimit = .context.Site.Params.list_limit -}}
                {{- end -}}
                {{ "<!-- range by title, but the Includes folder is for transclusion files only -->" | safeHTML }}
                {{- range first $listLimit (where $sections.ByTitle "Section" "!=" "evergreen-notes") }}
                <li class="collection-item"><a class="secondary-nav__link" href="{{ .Permalink }}">{{- .Title -}}</a></li>
                {{- end -}}
              {{- end }}  <!-- end date/weight/other if-else chain -->
            {{- end -}} <!-- yearly section -->
            </ul>
{{ "<!--END layouts/partials/items-contents.html -->" | safeHTML -}}
