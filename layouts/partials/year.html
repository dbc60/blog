{{ "<!-- BEGIN layouts/partials/year.html -->" | safeHTML }}

<!-- .Section is always the top-level location -->
{{ $currentSection := .context.Section }}
{{ $postsAll := where .context.Site.RegularPages.ByDate.Reverse "Type" "in" site.Params.mainSections }}

<!-- Get the relative URL of the current page (section/subsection) -->
{{ $url := replace .context.Permalink ( printf "%s" .context.Site.BaseURL) "" }}
{{ $firstItem := index $postsAll 0 }}

{{ $subpaths := split $url "/" }}
<ul class="social-items this-years-posts">
  {{ range $idxPost, $post := $postsAll }}
    <!-- the last subpath is empty, so 3 will have year, month and empty string -->
    {{ if eq 3 (len $subpaths) }}
      {{ if and (eq (.Date.Format "2006") (index $subpaths 0)) (eq (.Date.Format "01") (index $subpaths 1)) }}
      <li class="side-list-item"><a href="{{ $post.Permalink }}">{{ $post.Title }}</a></li>
      {{ end }}
    {{ else }}
      {{ if eq (.Date.Format "2006") (index $subpaths 0) }}
      <li class="side-list-item"><a href="{{ $post.Permalink }}">{{ $post.Title }}</a></li>
      {{ end }}
    {{ end }}
  {{ end }}
</ul> <!-- class="social-items this-years-posts" -->
{{- "<!-- END layouts/partials/year.html -->" | safeHTML -}}
